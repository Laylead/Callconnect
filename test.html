<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Watch Party Pro | CallConnect</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #8b5cf6;
            --secondary: #64748b;
            --light: #f8fafc;
            --dark: #1e293b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-color: #0f172a;
            --text-color: #f1f5f9;
            --card-bg: #1e293b;
            --sidebar-bg: #1e293b;
            --nav-bg: #1e293b;
            --input-bg: #334155;
            --video-bg: #000;
            --widget-bg: rgba(30, 41, 59, 0.95);
            --glass-bg: rgba(255, 255, 255, 0.08);
            --border-radius: 16px;
            --border-radius-sm: 8px;
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="light"] {
            --bg-color: #f8fafc;
            --text-color: #1e293b;
            --card-bg: #ffffff;
            --sidebar-bg: #ffffff;
            --nav-bg: #ffffff;
            --input-bg: #f1f5f9;
            --widget-bg: rgba(255, 255, 255, 0.95);
            --glass-bg: rgba(0, 0, 0, 0.05);
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
            touch-action: manipulation;
            transition: var(--transition);
        }
        
        /* App Container */
        .app-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Player View */
        .player-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
        }
        
        .player-view.hidden {
            transform: translateX(-100%);
            opacity: 0;
            pointer-events: none;
        }
        
        /* Detailed View */
        .detailed-view {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 5;
            opacity: 0;
            transform: translateX(100%);
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
            display: flex;
            flex-direction: column;
        }
        
        .detailed-view.active {
            transform: translateX(0);
            opacity: 1;
            pointer-events: all;
        }
        
        /* Video container */
        .video-container {
            background-color: var(--video-bg);
            border-radius: 0;
            overflow: hidden;
            box-shadow: none;
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        
        .detailed-view .video-container {
            height: 60vh;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--shadow);
        }
        
        #player-container {
            width: 100%;
            height: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #html5video {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        #overlay-block {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20;
            backdrop-filter: blur(10px);
        }
        
        #overlay-block.hidden {
            display: none;
        }
        
        .overlay-hint {
            background: var(--card-bg);
            padding: 20px 30px;
            border-radius: var(--border-radius);
            color: var(--text-color);
            font-weight: 500;
            text-align: center;
            max-width: 90%;
            box-shadow: var(--shadow);
            border: 1px solid var(--glass-bg);
        }
        
        /* Video controls */
        .custom-controls {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            align-items: center;
            background: rgba(0,0,0,0.8);
            padding: 15px 25px;
            border-radius: var(--border-radius);
            opacity: 0;
            transition: var(--transition);
            z-index: 30;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .video-container:hover .custom-controls,
        .touch-controls .custom-controls {
            opacity: 1;
        }
        
        .control-btn-lg {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--glass-bg);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        
        .control-btn-lg:hover {
            background: var(--primary);
            transform: scale(1.05);
        }
        
        .control-btn-lg:active {
            transform: scale(0.95);
        }
        
        .skip-btn {
            background: none;
            border: none;
            color: white;
            font-size: 14px;
            cursor: pointer;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: var(--transition);
            border-radius: var(--border-radius-sm);
        }
        
        .skip-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .skip-btn:active {
            transform: scale(0.95);
        }
        
        /* Floating Widgets */
        .floating-widgets {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1000;
        }
        
        .widget-container {
            position: relative;
        }
        
        .widget-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--widget-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: none;
            color: white;
            font-size: 20px;
            position: relative;
            z-index: 1001;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .widget-icon:hover {
            transform: scale(1.05);
            background: var(--primary);
        }
        
        .widget-icon:active {
            transform: scale(0.95);
        }
        
        .widget-icon.active {
            background: var(--primary);
            transform: scale(1.1);
        }
        
        .widget-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        /* Sidebar Menu */
        .sidebar-menu {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }
        
        .menu-btn {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--widget-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: none;
            color: white;
            font-size: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .menu-btn:hover {
            background: var(--primary);
            transform: scale(1.05);
        }
        
        .menu-btn:active {
            transform: scale(0.95);
        }
        
        /* Detailed View Layout */
        .detailed-content {
            flex: 1;
            display: grid;
            grid-template-columns: 1fr 380px;
            gap: 0;
            height: 40vh;
            overflow: hidden;
        }
        
        .control-panel {
            background: var(--card-bg);
            padding: 25px;
            overflow-y: auto;
            border-right: 1px solid var(--glass-bg);
        }
        
        .sidebar-panel {
            background: var(--sidebar-bg);
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        /* Section Headers */
        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--glass-bg);
        }
        
        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
        }
        
        /* Control Grids */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .control-card {
            background: var(--input-bg);
            border: 1px solid var(--glass-bg);
            border-radius: var(--border-radius-sm);
            padding: 16px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            text-align: center;
        }
        
        .control-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary);
            box-shadow: 0 8px 20px rgba(99, 102, 241, 0.2);
        }
        
        .control-card:active {
            transform: translateY(0);
        }
        
        .control-card.active {
            background: var(--primary);
            border-color: var(--primary);
        }
        
        .control-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: var(--transition);
        }
        
        .control-card.active .control-icon {
            background: rgba(255,255,255,0.2);
        }
        
        .control-label {
            font-size: 13px;
            font-weight: 500;
        }
        
        /* Speed Control */
        .speed-control {
            background: var(--input-bg);
            border-radius: var(--border-radius-sm);
            padding: 16px;
            border: 1px solid var(--glass-bg);
        }
        
        .speed-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .speed-select {
            width: 100%;
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--glass-bg);
            background: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            transition: var(--transition);
        }
        
        .speed-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        
        /* Chat Section */
        .chat-container {
            background: var(--input-bg);
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--glass-bg);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            height: 200px;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .message {
            display: flex;
            gap: 10px;
            max-width: 100%;
            animation: messageSlide 0.3s ease-out;
        }
        
        @keyframes messageSlide {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.self {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        
        .message-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: 600;
        }
        
        .message-content {
            padding: 12px 16px;
            border-radius: 18px;
            background-color: var(--glass-bg);
            font-size: 14px;
            line-height: 1.4;
            max-width: 80%;
        }
        
        .message.self .message-content {
            background-color: var(--primary);
            color: white;
        }
        
        .message-meta {
            font-size: 11px;
            color: var(--secondary);
            margin-top: 4px;
            display: flex;
            justify-content: space-between;
        }
        
        .chat-input-container {
            display: flex;
            gap: 12px;
            padding: 16px;
            border-top: 1px solid var(--glass-bg);
        }
        
        .chat-input {
            flex: 1;
            padding: 12px 16px;
            border-radius: 25px;
            border: 1px solid var(--glass-bg);
            background-color: var(--card-bg);
            color: var(--text-color);
            outline: none;
            transition: var(--transition);
            font-size: 14px;
        }
        
        .chat-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        
        .send-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .send-btn:hover {
            background-color: var(--primary-dark);
            transform: scale(1.05);
        }
        
        .send-btn:active {
            transform: scale(0.95);
        }
        
        /* Voice Controls */
        .voice-controls {
            background: var(--input-bg);
            border-radius: var(--border-radius-sm);
            padding: 20px;
            border: 1px solid var(--glass-bg);
            text-align: center;
        }
        
        .voice-btn {
            width: 100%;
            padding: 16px;
            border-radius: var(--border-radius-sm);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background-color: var(--primary);
            color: white;
            font-size: 15px;
        }
        
        .voice-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .voice-btn:active {
            transform: translateY(0);
        }
        
        .voice-btn.talking {
            background-color: var(--danger);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        .voice-status {
            font-size: 14px;
            color: var(--secondary);
            text-align: center;
            padding: 12px;
            background: var(--card-bg);
            border-radius: var(--border-radius-sm);
            margin-top: 12px;
        }
        
        /* Reactions Section */
        .reactions-section {
            background: var(--input-bg);
            border-radius: var(--border-radius-sm);
            padding: 20px;
            border: 1px solid var(--glass-bg);
        }
        
        .reactions-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .reaction-btn {
            padding: 12px;
            border-radius: var(--border-radius-sm);
            background: var(--card-bg);
            border: 1px solid var(--glass-bg);
            cursor: pointer;
            transition: var(--transition);
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .reaction-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
            border-color: var(--primary);
        }
        
        .reaction-btn:active {
            transform: scale(0.95);
        }
        
        /* Interactive Section */
        .interactive-section {
            background: var(--input-bg);
            border-radius: var(--border-radius-sm);
            padding: 20px;
            border: 1px solid var(--glass-bg);
        }
        
        .interactive-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .interactive-btn {
            padding: 14px;
            border-radius: var(--border-radius-sm);
            background: var(--card-bg);
            border: 1px solid var(--glass-bg);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .interactive-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .interactive-btn:active {
            transform: translateY(0);
        }
        
        /* Share Section */
        .share-section {
            background: var(--input-bg);
            border-radius: var(--border-radius-sm);
            padding: 20px;
            border: 1px solid var(--glass-bg);
        }
        
        .share-link-container {
            display: flex;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .share-link {
            flex: 1;
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            border: 1px solid var(--glass-bg);
            background-color: var(--card-bg);
            color: var(--text-color);
            font-size: 14px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .copy-btn {
            padding: 12px 20px;
            border-radius: var(--border-radius-sm);
            background-color: var(--primary);
            color: white;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .copy-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .copy-btn:active {
            transform: translateY(0);
        }
        
        .copy-btn.copied {
            background-color: var(--success);
        }
        
        /* Reactions Animation */
        #reactions {
            position: absolute;
            bottom: 80px;
            left: 0;
            width: 100%;
            z-index: 40;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }
        
        .reaction-bubble {
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 16px;
            border-radius: 25px;
            font-size: 22px;
            animation: floatUp 3s ease forwards;
            box-shadow: var(--shadow);
            margin-bottom: 10px;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            70% { opacity: 0.8; }
            100% { transform: translateY(-120px); opacity: 0; }
        }
        
        /* Video resize controls */
        .video-resize-controls {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 10px;
            z-index: 35;
            opacity: 0;
            transition: var(--transition);
        }
        
        .video-container:hover .video-resize-controls,
        .touch-controls .video-resize-controls {
            opacity: 1;
        }
        
        .resize-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0,0,0,0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            cursor: pointer;
            border: none;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .resize-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }
        
        .resize-btn:active {
            transform: scale(0.95);
        }
        
        /* Detailed View Header */
        .detailed-header {
            background: var(--card-bg);
            padding: 20px 25px;
            border-bottom: 1px solid var(--glass-bg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .detailed-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 22px;
            font-weight: 700;
            color: var(--primary);
        }
        
        .back-to-player {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            text-decoration: none;
            font-weight: 500;
            padding: 10px 18px;
            border-radius: var(--border-radius-sm);
            transition: var(--transition);
            background: var(--input-bg);
            border: 1px solid var(--glass-bg);
        }
        
        .back-to-player:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }
        
        .back-to-player:active {
            transform: translateY(0);
        }
        
        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .detailed-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr;
            }
            
            .control-panel {
                border-right: none;
                border-bottom: 1px solid var(--glass-bg);
                max-height: 40vh;
            }
            
            .sidebar-panel {
                max-height: 60vh;
            }
        }
        
        @media (max-width: 768px) {
            .floating-widgets {
                top: 15px;
                right: 15px;
                gap: 12px;
            }
            
            .sidebar-menu {
                top: 15px;
                left: 15px;
            }
            
            .widget-icon {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .menu-btn {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .custom-controls {
                bottom: 15px;
                padding: 12px 20px;
                gap: 12px;
            }
            
            .control-btn-lg {
                width: 44px;
                height: 44px;
                font-size: 16px;
            }
            
            .skip-btn {
                font-size: 13px;
                padding: 7px 10px;
            }
            
            .detailed-header {
                padding: 15px 20px;
            }
            
            .detailed-logo {
                font-size: 20px;
            }
            
            .control-panel, .sidebar-panel {
                padding: 20px;
            }
            
            .controls-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .reactions-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .floating-widgets {
                top: 10px;
                right: 10px;
                gap: 10px;
            }
            
            .sidebar-menu {
                top: 10px;
                left: 10px;
            }
            
            .widget-icon {
                width: 46px;
                height: 46px;
                font-size: 16px;
            }
            
            .menu-btn {
                width: 46px;
                height: 46px;
                font-size: 16px;
            }
            
            .custom-controls {
                bottom: 10px;
                padding: 10px 15px;
                gap: 10px;
            }
            
            .control-btn-lg {
                width: 40px;
                height: 40px;
                font-size: 15px;
            }
            
            .skip-btn {
                font-size: 12px;
                padding: 6px 8px;
            }
            
            .controls-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .reactions-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .interactive-grid {
                grid-template-columns: 1fr;
            }
            
            .detailed-view .video-container {
                height: 50vh;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--input-bg);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
    </style>
</head>
<body class="touch-controls" data-theme="dark">
    <div class="app-container">
        <!-- Player View -->
        <div class="player-view" id="player-view">
            <div class="video-container">
                <div id="player-container">
                    <video id="html5video" playsinline preload="metadata"></video>
                    <div id="overlay-block">
                        <div class="overlay-hint">Tap anywhere to start the video</div>
                    </div>
                    <div id="reactions"></div>
                    
                    <div class="video-resize-controls">
                        <button class="resize-btn" id="fit-screen-btn">
                            <i class="fas fa-expand-arrows-alt"></i>
                        </button>
                        <button class="resize-btn" id="fullscreen-btn">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </div>
                
                <div class="custom-controls">
                    <button class="control-btn-lg" id="custom-play-pause">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="skip-btn" id="skip-back">
                        <i class="fas fa-backward"></i> 10s
                    </button>
                    <button class="skip-btn" id="skip-forward">
                        10s <i class="fas fa-forward"></i>
                    </button>
                    <button class="control-btn-lg" id="custom-fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            
            <!-- Sidebar Menu -->
            <div class="sidebar-menu">
                <button class="menu-btn" id="menu-btn">
                    <i class="fas fa-th-large"></i>
                </button>
            </div>
            
            <!-- Floating Widgets -->
            <div class="floating-widgets">
                <!-- Voice Widget -->
                <div class="widget-container">
                    <button class="widget-icon" id="voice-widget">
                        <i class="fas fa-microphone"></i>
                    </button>
                </div>
                
                <!-- Reactions Widget -->
                <div class="widget-container">
                    <button class="widget-icon" id="reactions-widget">
                        <i class="fas fa-smile"></i>
                    </button>
                </div>
                
                <!-- Chat Widget -->
                <div class="widget-container">
                    <button class="widget-icon" id="chat-widget">
                        <i class="fas fa-comment"></i>
                        <div class="widget-badge" id="chat-badge" style="display: none;">0</div>
                    </button>
                </div>
                
                <!-- Share Widget -->
                <div class="widget-container">
                    <button class="widget-icon" id="share-widget">
                        <i class="fas fa-share-alt"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Detailed View -->
        <div class="detailed-view" id="detailed-view">
            <div class="detailed-header">
                <div class="detailed-logo">
                    <i class="fas fa-film"></i>
                    Watch Party Pro
                </div>
                <button class="back-to-player" id="back-to-player">
                    <i class="fas fa-arrow-left"></i>
                    Back to Player
                </button>
            </div>
            
            <div class="video-container">
                <div id="detailed-player-container">
                    <!-- Video will be moved here dynamically -->
                </div>
                
                <div class="custom-controls">
                    <button class="control-btn-lg" id="detailed-play-pause">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="skip-btn" id="detailed-skip-back">
                        <i class="fas fa-backward"></i> 10s
                    </button>
                    <button class="skip-btn" id="detailed-skip-forward">
                        10s <i class="fas fa-forward"></i>
                    </button>
                    <button class="control-btn-lg" id="detailed-fullscreen">
                        <i class="fas fa-expand"></i>
                    </button>
                </div>
            </div>
            
            <div class="detailed-content">
                <!-- Control Panel -->
                <div class="control-panel">
                    <!-- Video Controls Section -->
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-sliders-h"></i>
                        </div>
                        <h3 class="section-title">Video Controls</h3>
                    </div>
                    
                    <div class="controls-grid">
                        <div class="control-card" id="pauseDiscussBtn">
                            <div class="control-icon">
                                <i class="fas fa-pause"></i>
                            </div>
                            <div class="control-label">Pause & Discuss</div>
                        </div>
                        
                        <div class="control-card" id="toggleDrawBtn">
                            <div class="control-icon">
                                <i class="fas fa-pencil-alt"></i>
                            </div>
                            <div class="control-label">Drawing</div>
                        </div>
                        
                        <div class="control-card" id="clearDrawBtn">
                            <div class="control-icon">
                                <i class="fas fa-eraser"></i>
                            </div>
                            <div class="control-label">Clear Draw</div>
                        </div>
                        
                        <div class="control-card" id="spotlightBtn">
                            <div class="control-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="control-label">Spotlight</div>
                        </div>
                        
                        <div class="control-card" id="focusBtn">
                            <div class="control-icon">
                                <i class="fas fa-crosshairs"></i>
                            </div>
                            <div class="control-label">Focus Mode</div>
                        </div>
                        
                        <div class="control-card" id="syncBtn">
                            <div class="control-icon">
                                <i class="fas fa-sync"></i>
                            </div>
                            <div class="control-label">Sync Video</div>
                        </div>
                    </div>
                    
                    <!-- Playback Speed -->
                    <div class="speed-control">
                        <div class="speed-label">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Playback Speed</span>
                        </div>
                        <select id="speedSel" class="speed-select">
                            <option value="0.5">0.5x Slow</option>
                            <option value="0.75">0.75x</option>
                            <option value="1" selected>1.0x Normal</option>
                            <option value="1.25">1.25x</option>
                            <option value="1.5">1.5x Fast</option>
                            <option value="2">2.0x Very Fast</option>
                        </select>
                    </div>
                    
                    <!-- Interactive Features -->
                    <div class="section-header" style="margin-top: 25px;">
                        <div class="section-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h3 class="section-title">Interactive Features</h3>
                    </div>
                    
                    <div class="interactive-grid">
                        <button class="interactive-btn" id="predictBtn">
                            <i class="fas fa-crystal-ball"></i>
                            Create Prediction
                        </button>
                        <button class="interactive-btn" id="openPoll">
                            <i class="fas fa-chart-bar"></i>
                            Create Poll
                        </button>
                    </div>
                </div>
                
                <!-- Sidebar Panel -->
                <div class="sidebar-panel">
                    <!-- Chat Section -->
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <h3 class="section-title">Party Chat</h3>
                    </div>
                    
                    <div class="chat-container">
                        <div class="chat-messages" id="chat-messages">
                            <div class="message">
                                <div class="message-avatar">H</div>
                                <div class="message-content">
                                    Welcome to the watch party! üéâ Let's enjoy this together.
                                    <div class="message-meta">
                                        <span>Host</span>
                                        <span>Just now</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <input type="text" class="chat-input" id="chat-input" placeholder="Type your message...">
                            <button class="send-btn" id="chat-send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Voice Controls -->
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-microphone"></i>
                        </div>
                        <h3 class="section-title">Voice Chat</h3>
                    </div>
                    
                    <div class="voice-controls">
                        <button id="hold-talk-btn" class="voice-btn">
                            <i class="fas fa-microphone"></i> Hold to Talk
                        </button>
                        <div class="voice-status" id="voice-status">Voice ready - Hold to talk</div>
                    </div>
                    
                    <!-- Reactions -->
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-smile"></i>
                        </div>
                        <h3 class="section-title">Quick Reactions</h3>
                    </div>
                    
                    <div class="reactions-section">
                        <div class="reactions-grid">
                            <button class="reaction-btn" data-emoji="üòÇ">üòÇ</button>
                            <button class="reaction-btn" data-emoji="üò±">üò±</button>
                            <button class="reaction-btn" data-emoji="ü§®">ü§®</button>
                            <button class="reaction-btn" data-emoji="üëè">üëè</button>
                            <button class="reaction-btn" data-emoji="üî•">üî•</button>
                            <button class="reaction-btn" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
                            <button class="reaction-btn" data-emoji="üò¢">üò¢</button>
                            <button class="reaction-btn" data-emoji="üéâ">üéâ</button>
                        </div>
                    </div>
                    
                    <!-- Share Section -->
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-share-alt"></i>
                        </div>
                        <h3 class="section-title">Share Party</h3>
                    </div>
                    
                    <div class="share-section">
                        <div class="share-link-container">
                            <input type="text" class="share-link" id="share-link" readonly>
                            <button class="copy-btn" id="copy-btn">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                        <p style="font-size: 13px; color: var(--secondary); text-align: center;">
                            Share this link to invite friends to your watch party
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- External scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.9.0.js"></script>
    <script src="agora.js"></script>

    <script>
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const auth = firebase.auth();
        
        // Initialize Agora
        let agoraSession = null;
        let agoraLocalMicOn = false;
        
        // Get URL parameters
        const params = new URLSearchParams(location.search);
        const roomId = params.get('room') || 'default-room';
        const isHost = params.get('host') === 'true';

        // DOM elements
        const playerView = document.getElementById('player-view');
        const detailedView = document.getElementById('detailed-view');
        const menuBtn = document.getElementById('menu-btn');
        const backToPlayerBtn = document.getElementById('back-to-player');
        const html5video = document.getElementById('html5video');
        const overlayBlock = document.getElementById('overlay-block');
        const reactionsBox = document.getElementById('reactions');
        const detailedPlayerContainer = document.getElementById('detailed-player-container');

        // Video controls
        const playPauseBtn = document.getElementById('custom-play-pause');
        const detailedPlayPauseBtn = document.getElementById('detailed-play-pause');
        const skipBackBtn = document.getElementById('skip-back');
        const detailedSkipBackBtn = document.getElementById('detailed-skip-back');
        const skipForwardBtn = document.getElementById('skip-forward');
        const detailedSkipForwardBtn = document.getElementById('detailed-skip-forward');
        const fullscreenBtn = document.getElementById('custom-fullscreen');
        const detailedFullscreenBtn = document.getElementById('detailed-fullscreen');
        const fitScreenBtn = document.getElementById('fit-screen-btn');
        const fullscreenResizeBtn = document.getElementById('fullscreen-btn');

        // Control elements
        const speedSel = document.getElementById('speedSel');
        const pauseDiscussBtn = document.getElementById('pauseDiscussBtn');
        const toggleDrawBtn = document.getElementById('toggleDrawBtn');
        const clearDrawBtn = document.getElementById('clearDrawBtn');
        const spotlightBtn = document.getElementById('spotlightBtn');
        const focusBtn = document.getElementById('focusBtn');
        const syncBtn = document.getElementById('syncBtn');
        const holdTalkBtn = document.getElementById('hold-talk-btn');
        const voiceStatus = document.getElementById('voice-status');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSendBtn = document.getElementById('chat-send-btn');
        const predictBtn = document.getElementById('predictBtn');
        const openPoll = document.getElementById('openPoll');
        const shareLink = document.getElementById('share-link');
        const copyBtn = document.getElementById('copy-btn');

        // State variables
        let isPlaying = false;
        let isDetailedView = false;
        let unreadChatCount = 0;
        let drawingEnabled = false;

        // Initialize the app
        function initApp() {
            // Set up video
            setupVideo();
            
            // Set up event listeners
            setupEventListeners();
            
            // Set share link
            const currentUrl = window.location.href;
            shareLink.value = currentUrl;
            
            // Initialize Firebase room
            initFirebaseRoom();
            
            console.log('Watch Party Pro initialized');
        }

        // Set up video element
        function setupVideo() {
            // Use a sample video for demonstration
            html5video.src = 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4';
            html5video.preload = 'auto';
            
            // Video event listeners
            html5video.addEventListener('loadedmetadata', () => {
                console.log('Video loaded, duration:', html5video.duration);
            });
            
            html5video.addEventListener('play', () => {
                isPlaying = true;
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
                detailedPlayPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            });
            
            html5video.addEventListener('pause', () => {
                isPlaying = false;
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
                detailedPlayPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            });
            
            html5video.addEventListener('waiting', () => {
                console.log('Video buffering...');
            });
            
            html5video.addEventListener('canplay', () => {
                console.log('Video can play');
            });
            
            html5video.addEventListener('error', (e) => {
                console.error('Video error:', e);
                overlayBlock.querySelector('.overlay-hint').textContent = 'Error loading video. Tap to retry.';
            });
        }

        // Initialize Firebase room
        function initFirebaseRoom() {
            auth.signInAnonymously().catch(console.warn);
            
            const roomRef = db.ref('rooms/' + roomId);
            
            // Set up room if host
            if (isHost) {
                roomRef.set({
                    videoLink: html5video.src,
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    host: true
                });
            }
            
            // Listen for room updates
            roomRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    // Update room status
                    console.log('Room data:', data);
                }
            });
        }

        // Set up all event listeners
        function setupEventListeners() {
            // View toggle
            menuBtn.addEventListener('click', toggleToDetailedView);
            backToPlayerBtn.addEventListener('click', toggleToPlayerView);
            
            // Video controls
            playPauseBtn.addEventListener('click', togglePlayPause);
            detailedPlayPauseBtn.addEventListener('click', togglePlayPause);
            skipBackBtn.addEventListener('click', skipBackward);
            detailedSkipBackBtn.addEventListener('click', skipBackward);
            skipForwardBtn.addEventListener('click', skipForward);
            detailedSkipForwardBtn.addEventListener('click', skipForward);
            fullscreenBtn.addEventListener('click', toggleFullscreen);
            detailedFullscreenBtn.addEventListener('click', toggleFullscreen);
            fitScreenBtn.addEventListener('click', fitToScreen);
            fullscreenResizeBtn.addEventListener('click', toggleFullscreen);
            
            // Overlay tap to play
            overlayBlock.addEventListener('click', startVideo);
            
            // Control buttons
            pauseDiscussBtn.addEventListener('click', pauseAndDiscuss);
            toggleDrawBtn.addEventListener('click', toggleDrawing);
            clearDrawBtn.addEventListener('click', clearDrawing);
            spotlightBtn.addEventListener('click', activateSpotlight);
            focusBtn.addEventListener('click', activateFocusMode);
            syncBtn.addEventListener('click', syncVideo);
            predictBtn.addEventListener('click', createPrediction);
            openPoll.addEventListener('click', createPoll);
            
            // Hold to talk button
            setupHoldToTalk(holdTalkBtn);
            
            // Reaction buttons
            document.querySelectorAll('.reaction-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const emoji = e.target.getAttribute('data-emoji') || e.target.textContent;
                    sendReaction(emoji);
                });
            });
            
            // Chat send button
            chatSendBtn.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Copy button
            copyBtn.addEventListener('click', copyToClipboard);
            
            // Speed control
            speedSel.addEventListener('change', (e) => {
                html5video.playbackRate = parseFloat(e.target.value);
            });
            
            // Handle window resize
            window.addEventListener('resize', handleResize);
        }

        // View toggle functions
        function toggleToDetailedView() {
            isDetailedView = true;
            
            // Move video to detailed view
            detailedPlayerContainer.appendChild(html5video);
            detailedPlayerContainer.appendChild(reactionsBox);
            
            // Animate views
            playerView.classList.add('hidden');
            detailedView.classList.add('active');
            
            console.log('Switched to detailed view');
        }

        function toggleToPlayerView() {
            isDetailedView = false;
            
            // Move video back to player view
            const playerContainer = document.getElementById('player-container');
            playerContainer.appendChild(html5video);
            playerContainer.appendChild(reactionsBox);
            
            // Animate views
            detailedView.classList.remove('active');
            setTimeout(() => {
                playerView.classList.remove('hidden');
            }, 400);
            
            console.log('Switched to player view');
        }

        // Video control functions
        function startVideo() {
            html5video.play().then(() => {
                overlayBlock.classList.add('hidden');
            }).catch(error => {
                console.error('Error playing video:', error);
                overlayBlock.querySelector('.overlay-hint').textContent = 'Tap to play video';
            });
        }

        function togglePlayPause() {
            if (isPlaying) {
                html5video.pause();
            } else {
                html5video.play();
            }
        }

        function skipBackward() {
            html5video.currentTime = Math.max(0, html5video.currentTime - 10);
        }

        function skipForward() {
            html5video.currentTime = Math.min(html5video.duration, html5video.currentTime + 10);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                if (isDetailedView) {
                    detailedView.requestFullscreen().catch(err => {
                        console.error('Error attempting to enable fullscreen:', err);
                    });
                } else {
                    playerView.requestFullscreen().catch(err => {
                        console.error('Error attempting to enable fullscreen:', err);
                    });
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        function fitToScreen() {
            html5video.style.objectFit = 'contain';
        }

        // Control functions
        function pauseAndDiscuss() {
            html5video.pause();
            showNotification('Video paused for discussion');
            
            // Add visual feedback
            pauseDiscussBtn.classList.add('active');
            setTimeout(() => {
                pauseDiscussBtn.classList.remove('active');
            }, 1000);
        }

        function toggleDrawing() {
            drawingEnabled = !drawingEnabled;
            toggleDrawBtn.classList.toggle('active', drawingEnabled);
            showNotification(`Drawing ${drawingEnabled ? 'enabled' : 'disabled'}`);
        }

        function clearDrawing() {
            showNotification('Drawing cleared');
        }

        function activateSpotlight() {
            showNotification('Spotlight activated for 5 seconds');
            spotlightBtn.classList.add('active');
            setTimeout(() => {
                spotlightBtn.classList.remove('active');
            }, 5000);
        }

        function activateFocusMode() {
            showNotification('Focus mode activated');
            focusBtn.classList.add('active');
        }

        function syncVideo() {
            showNotification('Video synced with host');
            syncBtn.classList.add('active');
            setTimeout(() => {
                syncBtn.classList.remove('active');
            }, 1000);
        }

        function createPrediction() {
            const question = prompt('Enter prediction question:');
            if (question) {
                showNotification(`Prediction created: "${question}"`);
                
                // Add to Firebase
                const predictRef = db.ref('rooms/' + roomId + '/predicts').push();
                predictRef.set({
                    question: question,
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    options: {},
                    closed: false
                });
            }
        }

        function createPoll() {
            const question = prompt('Enter poll question:');
            if (question) {
                showNotification(`Poll created: "${question}"`);
                
                // Add to Firebase
                const pollRef = db.ref('rooms/' + roomId + '/polls').push();
                pollRef.set({
                    question: question,
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    options: {}
                });
            }
        }

        // Hold to talk functionality
        function setupHoldToTalk(button) {
            let pressTimer;
            
            button.addEventListener('mousedown', startTalking);
            button.addEventListener('touchstart', startTalking);
            
            button.addEventListener('mouseup', stopTalking);
            button.addEventListener('touchend', stopTalking);
            button.addEventListener('mouseleave', stopTalking);
            
            function startTalking(e) {
                e.preventDefault();
                voiceStatus.textContent = 'Talking...';
                button.classList.add('talking');
                
                // Start Agora voice transmission
                startAgoraVoice();
            }
            
            function stopTalking(e) {
                e.preventDefault();
                voiceStatus.textContent = 'Voice ready - Hold to talk';
                button.classList.remove('talking');
                
                // Stop Agora voice transmission
                stopAgoraVoice();
            }
        }

        // Agora voice functions
        function startAgoraVoice() {
            if (typeof initAgoraVoice === 'function') {
                initAgoraVoice({ 
                    firebase, 
                    auth, 
                    roomId, 
                    isHost, 
                    holdTalkBtn, 
                    voiceStatus 
                }).then(session => {
                    agoraSession = session;
                    agoraLocalMicOn = true;
                    console.log('Agora voice started');
                }).catch(error => {
                    console.error('Error starting Agora voice:', error);
                    voiceStatus.textContent = 'Voice error - check console';
                });
            } else {
                console.warn('Agora voice not available');
                voiceStatus.textContent = 'Voice not available';
            }
        }

        function stopAgoraVoice() {
            if (agoraSession && typeof agoraSession.leave === 'function') {
                agoraSession.leave().then(() => {
                    agoraLocalMicOn = false;
                    console.log('Agora voice stopped');
                }).catch(error => {
                    console.error('Error stopping Agora voice:', error);
                });
            }
            agoraLocalMicOn = false;
        }

        // Chat functionality
        function sendChatMessage() {
            const text = chatInput.value.trim();
            if (!text) return;
            
            // Create message element
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message self';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'Y';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const meta = document.createElement('div');
            meta.className = 'message-meta';
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            meta.innerHTML = `
                <span>You</span>
                <span>${timeStr}</span>
            `;
            
            const body = document.createElement('div');
            body.textContent = text;
            
            content.appendChild(body);
            content.appendChild(meta);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            
            // Add to chat
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Clear input
            chatInput.value = '';
            
            // Save to Firebase
            const chatRef = db.ref('rooms/' + roomId + '/chat').push();
            chatRef.set({
                text: text,
                userLabel: isHost ? 'Host' : 'Viewer',
                at: firebase.database.ServerValue.TIMESTAMP
            });
            
            // Simulate response after a delay
            setTimeout(simulateResponse, 1000 + Math.random() * 2000);
        }

        function simulateResponse() {
            const responses = [
                "That was hilarious! üòÇ",
                "I can't believe that just happened!",
                "This is my favorite part!",
                "Who else is watching this?",
                "This movie is amazing!",
                "I've seen this before but it's still great!",
                "Can we rewind that part?",
                "The acting in this scene is incredible!",
                "I love this soundtrack!",
                "What did you think of that plot twist?"
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            // Create response message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'V';
            
            const content = document.createElement('div');
            content.className = 'message-content';
            
            const meta = document.createElement('div');
            meta.className = 'message-meta';
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            meta.innerHTML = `
                <span>Viewer${Math.floor(Math.random() * 10) + 1}</span>
                <span>${timeStr}</span>
            `;
            
            const body = document.createElement('div');
            body.textContent = randomResponse;
            
            content.appendChild(body);
            content.appendChild(meta);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(content);
            
            // Add to chat
            chatMessages.appendChild(messageDiv);
            
            // Scroll to bottom
            chatMessages.scrollTop = chatMessages.scrollHeight;
            
            // Save to Firebase
            const chatRef = db.ref('rooms/' + roomId + '/chat').push();
            chatRef.set({
                text: randomResponse,
                userLabel: 'Viewer',
                at: firebase.database.ServerValue.TIMESTAMP
            });
        }

        // Reactions
        function sendReaction(emoji) {
            // Create reaction bubble
            const bubble = document.createElement('div');
            bubble.className = 'reaction-bubble';
            bubble.textContent = emoji;
            reactionsBox.appendChild(bubble);
            
            // Remove after animation
            setTimeout(() => {
                bubble.remove();
            }, 3000);
            
            // Save to Firebase
            const reactionsRef = db.ref('rooms/' + roomId + '/reactions').push();
            reactionsRef.set({
                emoji: emoji,
                at: firebase.database.ServerValue.TIMESTAMP
            });
            
            console.log(`Reaction sent: ${emoji}`);
        }

        // Listen for reactions from Firebase
        db.ref('rooms/' + roomId + '/reactions').on('child_added', (snapshot) => {
            const reaction = snapshot.val();
            if (reaction && reaction.emoji) {
                // Create reaction bubble
                const bubble = document.createElement('div');
                bubble.className = 'reaction-bubble';
                bubble.textContent = reaction.emoji;
                reactionsBox.appendChild(bubble);
                
                // Remove after animation
                setTimeout(() => {
                    bubble.remove();
                }, 3000);
            }
        });

        // Copy to clipboard
        function copyToClipboard() {
            shareLink.select();
            document.execCommand('copy');
            
            const originalText = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            copyBtn.classList.add('copied');
            
            setTimeout(() => {
                copyBtn.innerHTML = originalText;
                copyBtn.classList.remove('copied');
            }, 2000);
        }

        // Utility functions
        function showNotification(message) {
            // Create a notification
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--primary);
                color: white;
                padding: 12px 20px;
                border-radius: var(--border-radius-sm);
                z-index: 10000;
                font-weight: 500;
                box-shadow: var(--shadow);
                animation: slideDown 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideUp 0.3s ease';
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        function handleResize() {
            // Adjust UI for different screen sizes
            if (window.innerWidth <= 768) {
                document.body.classList.add('touch-controls');
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
