<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RADIO | Podcast Dashboard</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        :root {
            --primary-purple: #6A0DFF;
            --secondary-purple: #8A4FFF;
            --light-purple: #CBB2FF;
            --neon-magenta: #D300FF;
            --dark-bg-1: #1A043A;
            --dark-bg-2: #09001F;
            --dark-bg-3: #050016;
            --card-bg: rgba(255, 255, 255, 0.08);
            --border-light: rgba(255, 255, 255, 0.12);
            --text-primary: #F8F8FF;
            --text-secondary: #C8C8D9;
            --text-accent: #CBB2FF;
            --green-accent: #00FF88;
            --red-accent: #FF4757;
            --yellow-accent: #FFD700;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --success: #00D68F;
            --info: #0095FF;
            --warning: #FFAA00;
            --safe-area-top: env(safe-area-inset-top);
            --safe-area-bottom: env(safe-area-inset-bottom);
        }

        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(160deg, var(--dark-bg-1) 0%, var(--dark-bg-2) 50%, var(--dark-bg-3) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            touch-action: pan-y;
            padding: env(safe-area-inset-top) 0 env(safe-area-bottom) 0;
            overscroll-behavior: none;
        }

        /* ===== PERFECT BACKGROUND ===== */
        .bg-blur {
            position: fixed;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.15;
            z-index: 0;
            pointer-events: none;
            will-change: transform;
        }

        .bg-blur-1 {
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, var(--primary-purple) 0%, transparent 70%);
            top: -200px;
            left: -200px;
            animation: float 25s infinite ease-in-out;
        }

        .bg-blur-2 {
            width: 350px;
            height: 350px;
            background: radial-gradient(circle, var(--neon-magenta) 0%, transparent 70%);
            bottom: -150px;
            right: -150px;
            animation: float 30s infinite ease-in-out reverse;
        }

        /* ===== MAIN CONTAINER ===== */
        .container {
            max-width: 100%;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            min-height: 100vh;
            overflow: hidden;
        }

        /* ===== HEADER ===== */
        .header {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(5, 0, 22, 0.9);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            position: fixed;
            top: var(--safe-area-top);
            left: 0;
            right: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            height: 60px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 900;
            font-size: 24px;
            letter-spacing: 1px;
            background: linear-gradient(135deg, var(--primary-purple), var(--light-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-transform: uppercase;
            font-family: 'Poppins', sans-serif;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .header-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 13, 255, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background: var(--primary-purple);
            border-radius: 50%;
            border: 2px solid var(--dark-bg-2);
            animation: pulse 1.5s infinite;
        }

        /* ===== VERTICAL FEED ===== */
        .vertical-feed {
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 70px;
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
            padding: 0;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .vertical-feed::-webkit-scrollbar {
            display: none;
        }

        .feed-card {
            height: calc(100vh - 130px);
            min-height: calc(100vh - 130px);
            scroll-snap-align: start;
            position: relative;
            overflow: hidden;
            border-radius: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 20px;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .feed-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.5) 50%, transparent 100%);
            z-index: 1;
        }

        .feed-card-content {
            position: relative;
            z-index: 2;
            width: 100%;
            animation: fadeInUp 0.5s ease-out;
            max-height: 85%;
            overflow-y: auto;
            padding-right: 10px;
            scrollbar-width: thin;
            scrollbar-color: var(--primary-purple) transparent;
        }

        .feed-card-content::-webkit-scrollbar {
            width: 4px;
        }

        .feed-card-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .feed-card-content::-webkit-scrollbar-thumb {
            background: var(--primary-purple);
            border-radius: 2px;
        }

        .card-tags {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .card-tag {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            letter-spacing: 0.5px;
        }

        .card-tag.live {
            background: linear-gradient(135deg, var(--red-accent), #ff6b6b);
        }

        .card-tag.hot {
            background: linear-gradient(135deg, var(--warning), #ffaa00);
        }

        .card-tag.trending {
            background: linear-gradient(135deg, var(--success), #00b894);
        }

        .card-tag.podcast {
            background: linear-gradient(135deg, var(--primary-purple), var(--neon-magenta));
        }

        .card-tag.audio {
            background: linear-gradient(135deg, var(--warning), #ffaa00);
        }

        .card-tag.new {
            background: linear-gradient(135deg, var(--info), #0095FF);
        }

        .card-tag.starting-soon {
            background: linear-gradient(135deg, #00D68F, #00b894);
            animation: pulse 2s infinite;
        }

        .card-title {
            font-size: 28px;
            font-weight: 800;
            color: white;
            margin-bottom: 12px;
            line-height: 1.2;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            font-family: 'Poppins', sans-serif;
        }

        .card-description {
            font-size: 16px;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 20px;
            line-height: 1.4;
            max-width: 90%;
            font-weight: 400;
        }

        /* ===== CARD TYPE INDICATORS ===== */
        .card-type-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 3;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
        }

        .card-type-indicator.podcast {
            background: linear-gradient(135deg, rgba(106, 13, 255, 0.8), rgba(211, 0, 255, 0.8));
            border-color: var(--primary-purple);
        }

        .card-type-indicator.audio {
            background: linear-gradient(135deg, rgba(255, 170, 0, 0.8), rgba(255, 215, 0, 0.8));
            border-color: var(--warning);
        }

        .card-type-indicator.radio {
            background: linear-gradient(135deg, rgba(0, 149, 255, 0.8), rgba(0, 213, 143, 0.8));
            border-color: var(--info);
        }

        /* ===== STATS & ACTIONS ===== */
        .card-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .viewers-count {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .viewers-count i {
            color: var(--primary-purple);
        }

        .card-actions {
            display: flex;
            gap: 12px;
            width: 174px;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            flex-shrink: 0;
        }

        .action-btn:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.25);
        }

        .action-btn.liked {
            background: linear-gradient(135deg, var(--primary-purple), var(--neon-magenta));
            border: none;
            box-shadow: 0 8px 25px rgba(106, 13, 255, 0.4);
        }

        .action-btn.liked i {
            color: white;
        }

        .action-btn.playing {
            background: linear-gradient(135deg, var(--success), #00b894);
            border: none;
            box-shadow: 0 8px 25px rgba(0, 214, 143, 0.4);
            animation: pulse 1.5s infinite;
        }

        .like-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--primary-purple);
            color: white;
            font-size: 10px;
            font-weight: bold;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--dark-bg-2);
        }

        /* ===== ADVANCED AUDIO PLAYER CONTROLS ===== */
        .audio-player-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(5, 0, 22, 0.95);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 10;
            box-shadow: 0 -10px 30px rgba(0, 0, 0, 0.5);
        }

        .feed-card.playing .audio-player-overlay {
            transform: translateY(0);
        }

        .player-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .player-track-info {
            flex: 1;
            overflow: hidden;
        }

        .player-track-title {
            font-size: 16px;
            font-weight: 700;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }

        .player-track-author {
            font-size: 12px;
            color: var(--text-secondary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .player-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .player-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* ===== PROGRESS BAR ===== */
        .progress-container {
            width: 100%;
            margin: 20px 0;
            position: relative;
        }

        .progress-bar {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .progress-bar::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-purple);
            border: 3px solid white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(106, 13, 255, 0.5);
            transition: all 0.2s ease;
        }

        .progress-bar::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 0 15px rgba(106, 13, 255, 0.7);
        }

        .progress-bar::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-purple);
            border: 3px solid white;
            cursor: pointer;
            box-shadow: 0 0 10px rgba(106, 13, 255, 0.5);
        }

        .progress-time {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        /* ===== PLAYBACK CONTROLS ===== */
        .playback-controls {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .control-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .control-btn.play-pause {
            width: 60px;
            height: 60px;
            font-size: 24px;
            background: linear-gradient(135deg, var(--primary-purple), var(--neon-magenta));
            border: none;
            box-shadow: 0 8px 25px rgba(106, 13, 255, 0.4);
        }

        .control-btn.play-pause:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(106, 13, 255, 0.6);
        }

        .control-btn.skip {
            font-size: 16px;
        }

        /* ===== AUDIO VISUALIZER ===== */
        .audio-visualizer-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .feed-card.playing .audio-visualizer-container {
            opacity: 0.3;
        }

        .audio-visualizer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px;
            display: flex;
            align-items: flex-end;
            justify-content: center;
            gap: 3px;
            padding: 0 20px;
            overflow: hidden;
        }

        .visualizer-bar {
            flex: 1;
            min-width: 4px;
            background: linear-gradient(180deg, transparent, var(--primary-purple));
            border-radius: 2px 2px 0 0;
            animation: visualizerWave 1.5s ease-in-out infinite;
            transform-origin: bottom;
        }

        @keyframes visualizerWave {
            0%, 100% { 
                transform: scaleY(0.3); 
                opacity: 0.5;
            }
            50% { 
                transform: scaleY(1); 
                opacity: 1;
            }
        }

        /* Generate different animation delays for bars */
        .visualizer-bar:nth-child(1) { animation-delay: 0.1s; height: 20px; }
        .visualizer-bar:nth-child(2) { animation-delay: 0.2s; height: 40px; }
        .visualizer-bar:nth-child(3) { animation-delay: 0.3s; height: 60px; }
        .visualizer-bar:nth-child(4) { animation-delay: 0.4s; height: 80px; }
        .visualizer-bar:nth-child(5) { animation-delay: 0.5s; height: 100px; }
        .visualizer-bar:nth-child(6) { animation-delay: 0.6s; height: 120px; }
        .visualizer-bar:nth-child(7) { animation-delay: 0.7s; height: 100px; }
        .visualizer-bar:nth-child(8) { animation-delay: 0.8s; height: 80px; }
        .visualizer-bar:nth-child(9) { animation-delay: 0.9s; height: 60px; }
        .visualizer-bar:nth-child(10) { animation-delay: 1s; height: 40px; }
        .visualizer-bar:nth-child(11) { animation-delay: 1.1s; height: 20px; }
        .visualizer-bar:nth-child(12) { animation-delay: 1.2s; height: 40px; }
        .visualizer-bar:nth-child(13) { animation-delay: 1.3s; height: 60px; }
        .visualizer-bar:nth-child(14) { animation-delay: 1.4s; height: 80px; }
        .visualizer-bar:nth-child(15) { animation-delay: 1.5s; height: 100px; }

        /* ===== LIVE INDICATOR ===== */
        .live-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 3;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 71, 87, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 71, 87, 0.3);
            padding: 8px 16px;
            border-radius: 20px;
            animation: pulseLive 2s infinite;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--red-accent);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }

        .live-text {
            font-size: 14px;
            font-weight: 700;
            color: white;
            letter-spacing: 1px;
        }

        /* ===== BOTTOM NAVIGATION ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(5, 0, 22, 0.95);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            padding: 12px 20px calc(12px + env(safe-area-inset-bottom));
            z-index: 1000;
            height: 70px;
        }

        .nav-items {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 480px;
            margin: 0 auto;
            height: 100%;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 11px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 10px 14px;
            border-radius: 16px;
            min-width: 60px;
            font-weight: 600;
        }

        .nav-item.active {
            color: var(--primary-purple);
            background: rgba(106, 13, 255, 0.15);
            box-shadow: 0 4px 20px rgba(106, 13, 255, 0.2);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item:hover {
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        .submit-story-btn {
            background: linear-gradient(135deg, var(--primary-purple), var(--neon-magenta));
            color: white;
            border: none;
            width: 52px;
            height: 52px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 30px rgba(106, 13, 255, 0.4);
            margin-top: -30px;
            position: relative;
            overflow: hidden;
        }

        .submit-story-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: transform 0.6s;
        }

        .submit-story-btn:hover::after {
            transform: rotate(45deg) translate(50%, 50%);
        }

        .submit-story-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(106, 13, 255, 0.6);
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(30px);
            -webkit-backdrop-filter: blur(30px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            padding: 20px;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(5, 0, 22, 0.98), rgba(26, 4, 58, 0.98));
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 24px;
            padding: 30px;
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(50px);
            transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .modal-overlay.active .modal-content {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 28px;
            font-weight: 800;
            color: var(--text-primary);
            background: linear-gradient(135deg, var(--primary-purple), var(--neon-magenta));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 28px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* ===== STORY SUBMISSION FORM ===== */
        .story-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            position: relative;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input, .form-textarea {
            width: 100%;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.07);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text-primary);
            font-size: 15px;
            font-weight: 500;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-input:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-purple);
            box-shadow: 0 0 0 3px rgba(106, 13, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
        }

        .terms-container {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 16px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 16px;
        }

        .terms-content {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .terms-content h3 {
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .terms-content p {
            margin-bottom: 10px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 20px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            accent-color: var(--primary-purple);
        }

        .checkbox-group label {
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .text-editor-toolbar {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }

        .editor-btn {
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
        }

        .editor-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--primary-purple);
        }

        .editor-btn.active {
            background: var(--primary-purple);
            border-color: var(--primary-purple);
        }

        .form-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 30px;
        }

        .form-btn {
            padding: 16px;
            border-radius: 14px;
            border: none;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-align: center;
        }

        .form-btn.submit {
            background: linear-gradient(135deg, var(--primary-purple), var(--neon-magenta));
            color: white;
        }

        .form-btn.email {
            background: linear-gradient(135deg, var(--success), #00b894);
            color: white;
        }

        .form-btn.cancel {
            background: rgba(255, 255, 255, 0.07);
            color: var(--text-primary);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        .form-btn:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        /* ===== LIKE POPUP ===== */
        .like-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: linear-gradient(135deg, rgba(5, 0, 22, 0.98), rgba(26, 4, 58, 0.98));
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 24px;
            width: 90%;
            max-width: 350px;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(40px);
        }

        .like-popup.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .like-popup-content {
            text-align: center;
        }

        .like-popup-icon {
            font-size: 48px;
            color: var(--primary-purple);
            margin-bottom: 16px;
        }

        .like-popup h3 {
            font-size: 20px;
            margin-bottom: 12px;
            color: var(--text-primary);
        }

        .like-popup p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .dont-show-again {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            margin-top: 20px;
        }

        .dont-show-again input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: var(--primary-purple);
        }

        .dont-show-again label {
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            33% { transform: translate(40px, -60px) rotate(120deg); }
            66% { transform: translate(-30px, 30px) rotate(240deg); }
        }

        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateY(40px) scale(0.95); 
            }
            to { 
                opacity: 1; 
                transform: translateY(0) scale(1); 
            }
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 1; 
                transform: scale(1); 
            }
            50% { 
                opacity: 0.7; 
                transform: scale(1.1); 
            }
        }

        @keyframes pulseLive {
            0%, 100% { 
                box-shadow: 0 0 0 0 rgba(255, 71, 87, 0.4); 
            }
            70% { 
                box-shadow: 0 0 0 10px rgba(255, 71, 87, 0); 
            }
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .header {
                padding: 12px 16px;
                height: 56px;
            }
            
            .logo {
                font-size: 22px;
            }
            
            .header-btn {
                width: 36px;
                height: 36px;
                font-size: 16px;
            }
            
            .vertical-feed {
                top: 56px;
                bottom: 70px;
            }
            
            .feed-card {
                height: calc(100vh - 126px);
                min-height: calc(100vh - 126px);
                padding: 16px;
            }
            
            .card-title {
                font-size: 24px;
            }
            
            .card-description {
                font-size: 14px;
                max-width: 100%;
            }
            
            .action-btn {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .card-actions {
                width: 154px;
            }
            
            .bottom-nav {
                padding: 10px 16px calc(10px + env(safe-area-inset-bottom));
                height: 70px;
            }
            
            .nav-item {
                padding: 8px 12px;
                min-width: 56px;
                font-size: 10px;
            }
            
            .nav-item i {
                font-size: 18px;
            }
            
            .submit-story-btn {
                width: 48px;
                height: 48px;
                font-size: 22px;
                margin-top: -24px;
            }
            
            .modal-content {
                padding: 24px 20px;
            }
            
            .modal-title {
                font-size: 24px;
            }
            
            .audio-player-overlay {
                padding: 16px;
            }
            
            .control-btn {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .control-btn.play-pause {
                width: 52px;
                height: 52px;
                font-size: 20px;
            }
        }

        /* ===== SWIPE HINTS ===== */
        .swipe-hint {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            text-align: center;
            animation: floatUp 2s infinite ease-in-out;
            pointer-events: none;
            z-index: 100;
            background: rgba(0, 0, 0, 0.4);
            padding: 8px 16px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .swipe-hint i {
            font-size: 16px;
        }

        @keyframes floatUp {
            0% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
            100% { transform: translateX(-50%) translateY(0); }
        }

        /* ===== SCROLL INDICATOR ===== */
        .scroll-indicator {
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            opacity: 0.5;
            animation: pulse 2s infinite;
            z-index: 100;
        }

        .scroll-dot {
            width: 8px;
            height: 8px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .scroll-dot.active {
            background: var(--primary-purple);
            transform: scale(1.2);
        }

        /* ===== UTILITY CLASSES ===== */
        .hide {
            display: none !important;
        }

        .show {
            display: block !important;
        }

        .fade-in {
            animation: fadeInUp 0.5s ease-out;
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: rgba(5, 0, 22, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 16px 24px;
            color: white;
            font-weight: 600;
            z-index: 3000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            font-size: 15px;
            max-width: 90%;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <!-- Profile Modal -->
    <div class="modal-overlay" id="profileModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeProfileModal()">×</button>
            <h2 class="modal-title">Edit Profile</h2>
            <form class="profile-form" id="profileForm">
                <div class="avatar-upload">
                    <div class="avatar-preview" id="avatarPreview" onclick="document.getElementById('avatarInput').click()">
                        <span id="avatarInitials">U</span>
                    </div>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                    <div class="avatar-actions">
                        <button type="button" class="form-btn submit" onclick="document.getElementById('avatarInput').click()">
                            <i class="fas fa-camera"></i> Upload
                        </button>
                        <button type="button" class="form-btn cancel" onclick="deleteProfilePicture()">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="userName">Full Name</label>
                    <input type="text" id="userName" class="form-input" placeholder="Enter your name" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="userEmail">Email Address</label>
                    <input type="email" id="userEmail" class="form-input" placeholder="your@email.com" required>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="form-btn submit">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                    <button type="button" class="form-btn cancel" onclick="closeProfileModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" class="form-btn cancel" onclick="signOut()">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Story Submission Modal -->
    <div class="modal-overlay" id="storyModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeStoryModal()">×</button>
            <h2 class="modal-title">Submit Your Story</h2>
            <form class="story-form" id="storyForm">
                <div class="form-group">
                    <label class="form-label" for="storyTitle">Story Title</label>
                    <input type="text" id="storyTitle" class="form-input" placeholder="Enter your story title" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="storyContent">Your Story</label>
                    <div class="text-editor-toolbar">
                        <button type="button" class="editor-btn" onclick="formatText('bold')">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button type="button" class="editor-btn" onclick="formatText('italic')">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button type="button" class="editor-btn" onclick="formatText('underline')">
                            <i class="fas fa-underline"></i>
                        </button>
                    </div>
                    <textarea id="storyContent" class="form-textarea" placeholder="Tell your story here... You can write as much as you want!" rows="8" required></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Terms and Conditions</label>
                    <div class="terms-container">
                        <div class="terms-content">
                            <h3>Submission Guidelines</h3>
                            <p>1. By submitting your story, you grant us permission to publish it on our platform.</p>
                            <p>2. Your story must be original and not violate any copyrights.</p>
                            <p>3. We reserve the right to edit stories for clarity and length.</p>
                            <p>4. Stories containing hate speech, harassment, or explicit content will be rejected.</p>
                            <p>5. You retain the copyright to your story but grant us a license to publish it.</p>
                            <p>6. We may contact you via email regarding your submission.</p>
                            <p>7. Submission does not guarantee publication.</p>
                        </div>
                    </div>
                </div>
                
                <div class="checkbox-group">
                    <input type="checkbox" id="agreeTerms" required>
                    <label for="agreeTerms">I agree to the terms and conditions</label>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="form-btn submit">
                        <i class="fas fa-paper-plane"></i> Submit Story
                    </button>
                    <button type="button" class="form-btn email" onclick="submitViaEmail()">
                        <i class="fas fa-envelope"></i> Submit via Email
                    </button>
                    <button type="button" class="form-btn cancel" onclick="closeStoryModal()">
                        Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Like Popup Modal -->
    <div class="like-popup" id="likePopup">
        <div class="like-popup-content">
            <div class="like-popup-icon">
                <i class="fas fa-heart"></i>
            </div>
            <h3>Save to Favorites</h3>
            <p>Liking this story will save it to your Saved section for easy access later.</p>
            <button class="form-btn submit" onclick="closeLikePopup()">
                Got it!
            </button>
            <div class="dont-show-again">
                <input type="checkbox" id="dontShowAgain">
                <label for="dontShowAgain">Don't show this again</label>
            </div>
        </div>
    </div>

    <!-- Animated Background -->
    <div class="bg-blur bg-blur-1"></div>
    <div class="bg-blur bg-blur-2"></div>

    <!-- Swipe Hint -->
    <div class="swipe-hint" id="swipeHint">
        <i class="fas fa-arrow-up"></i>
        <span>Swipe up for more stories</span>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Main App -->
    <div class="container" id="mainApp">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span>RADIO</span>
            </div>
            <div class="header-right">
                <button class="header-btn" id="notificationBtn" onclick="showComingSoon('Notifications')">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge"></span>
                </button>
                <button class="header-btn" id="profileBtn" onclick="openProfileModal()">
                    <span id="profileInitials">U</span>
                </button>
            </div>
        </header>

        <!-- Vertical Feed -->
        <div class="vertical-feed" id="verticalFeed">
            <!-- Feed cards will be loaded dynamically -->
        </div>

        <!-- Scroll Indicator -->
        <div class="scroll-indicator" id="scrollIndicator">
            <!-- Dots will be added dynamically -->
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-items">
                <a href="dashboard.html" class="nav-item active">
                    <i class="fas fa-stream"></i>
                    <span>Feed</span>
                </a>
                <a href="explore.html" class="nav-item">
                    <i class="fas fa-compass"></i>
                    <span>Explore</span>
                </a>
                <button class="submit-story-btn" onclick="openStoryModal()">
                    <i class="fas fa-plus"></i>
                </button>
                <a href="donate.html" class="nav-item">
                    <i class="fas fa-heart"></i>
                    <span>Donate</span>
                </a>
                <a href="saved.html" class="nav-item">
                    <i class="fas fa-bookmark"></i>
                    <span>Saved</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- External Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="firebase-config.js"></script>

    <!-- Main Application Script -->
    <script>
        // Firebase Initialization
        let firebaseApp;
        let auth;
        let db;
        let storage;

        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            db = firebase.database();
            storage = firebase.storage();
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.error("Firebase initialization error:", error);
            showToast("Firebase initialization failed", "error");
            window.location.href = "index.html";
        }

        // Variables
        let currentFeedIndex = 0;
        let feedCards = [];
        let likedStories = new Set();
        let currentAudio = null;
        let currentPlayingCard = null;
        let likePopupCount = 0;
        let dontShowLikePopup = false;
        let cachedStories = null;
        let lastUpdateTime = null;
        let audioProgressInterval = null;

        // Firebase Authentication State Listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                console.log("User logged in:", user.email);
                updateUserProfile(user);
                loadUserData(user.uid);
                loadLikedStories(user.uid);
                loadFeed();
                simulateLiveUpdates();
                
                // Load like popup preference
                const popupPref = localStorage.getItem('dontShowLikePopup');
                if (popupPref === 'true') {
                    dontShowLikePopup = true;
                }
                
                // Load like popup count
                const popupCount = localStorage.getItem('likePopupCount');
                if (popupCount) {
                    likePopupCount = parseInt(popupCount);
                }
            } else {
                console.log("User not logged in, redirecting to index.html");
                window.location.href = "index.html";
            }
        });

        // Initialize app when DOM loads
        document.addEventListener('DOMContentLoaded', function() {
            // Profile form submission
            document.getElementById('profileForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const name = document.getElementById('userName').value;
                const email = document.getElementById('userEmail').value;
                
                // Get current user
                const currentUser = auth.currentUser;
                
                if (!currentUser) {
                    showToast("You must be logged in to update profile", "error");
                    return;
                }
                
                // Show loading
                showToast("Updating profile...", "info");
                
                try {
                    let photoURL = currentUser.photoURL;
                    
                    // Handle avatar upload
                    const avatarInput = document.getElementById('avatarInput');
                    if (avatarInput.files && avatarInput.files[0]) {
                        const file = avatarInput.files[0];
                        showToast("Uploading image...", "info");
                        
                        // Create a reference to the file location
                        const storageRef = storage.ref('profile_images/' + currentUser.uid + '/' + Date.now() + '_' + file.name);
                        
                        // Upload file
                        await storageRef.put(file);
                        
                        // Get download URL
                        photoURL = await storageRef.getDownloadURL();
                        console.log("Image uploaded to:", photoURL);
                    }
                    
                    // Update Firebase user profile
                    await currentUser.updateProfile({
                        displayName: name,
                        photoURL: photoURL
                    });
                    
                    if (email !== currentUser.email) {
                        await currentUser.updateEmail(email);
                    }
                    
                    // Save to Firebase database
                    await db.ref('users/' + currentUser.uid).set({
                        displayName: name,
                        email: email,
                        photoURL: photoURL || null,
                        updatedAt: Date.now()
                    }, { merge: true });
                    
                    showToast("Profile updated successfully!", "success");
                    
                    // Update UI
                    updateUserProfile(currentUser);
                    
                    // Close modal after delay
                    setTimeout(() => {
                        closeProfileModal();
                    }, 1500);
                    
                } catch (error) {
                    console.error("Profile update error:", error);
                    showToast("Profile update failed: " + error.message, "error");
                }
            });

            // Story form submission
            document.getElementById('storyForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const title = document.getElementById('storyTitle').value;
                const content = document.getElementById('storyContent').value;
                const agreeTerms = document.getElementById('agreeTerms').checked;
                
                if (!agreeTerms) {
                    showToast("You must agree to the terms and conditions", "error");
                    return;
                }
                
                const currentUser = auth.currentUser;
                if (!currentUser) {
                    showToast("You must be logged in to submit a story", "error");
                    return;
                }
                
                showToast("Submitting your story...", "info");
                
                try {
                    // Save story to Firebase
                    const storyRef = db.ref('stories').push();
                    await storyRef.set({
                        title: title,
                        content: content,
                        authorId: currentUser.uid,
                        authorName: currentUser.displayName || 'Anonymous',
                        createdAt: Date.now(),
                        likes: 0,
                        plays: 0,
                        tags: []
                    });
                    
                    showToast("Story submitted successfully!", "success");
                    
                    // Clear form
                    document.getElementById('storyForm').reset();
                    
                    // Close modal after delay
                    setTimeout(() => {
                        closeStoryModal();
                    }, 1500);
                    
                    // Refresh feed to show new story
                    setTimeout(() => {
                        loadFeed();
                    }, 2000);
                    
                } catch (error) {
                    console.error("Story submission error:", error);
                    showToast("Story submission failed: " + error.message, "error");
                }
            });

            // Avatar upload preview
            document.getElementById('avatarInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const avatarPreview = document.getElementById('avatarPreview');
                        avatarPreview.innerHTML = `<img src="${event.target.result}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Close modals on outside click
            document.getElementById('profileModal').addEventListener('click', function(e) {
                if (e.target === this) closeProfileModal();
            });
            
            document.getElementById('storyModal').addEventListener('click', function(e) {
                if (e.target === this) closeStoryModal();
            });
            
            document.getElementById('likePopup').addEventListener('click', function(e) {
                if (e.target === this) closeLikePopup();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    openStoryModal();
                }
                
                if (e.key === 'Escape') {
                    closeProfileModal();
                    closeStoryModal();
                    closeLikePopup();
                }
                
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    e.preventDefault();
                    openProfileModal();
                }
                
                // Space bar to play/pause audio
                if (e.key === ' ' && !e.target.matches('input, textarea')) {
                    e.preventDefault();
                    if (currentAudio) {
                        toggleAudioPlayback();
                    }
                }
                
                // Left arrow for rewind
                if (e.key === 'ArrowLeft' && currentAudio) {
                    e.preventDefault();
                    skipBackward();
                }
                
                // Right arrow for forward
                if (e.key === 'ArrowRight' && currentAudio) {
                    e.preventDefault();
                    skipForward();
                }
            });
        });

        // ===== FEED SYSTEM =====
        function loadFeed() {
            // Check cache first
            const cachedData = localStorage.getItem('radioStories');
            const cacheTime = localStorage.getItem('radioStoriesTime');
            
            if (cachedData && cacheTime && (Date.now() - parseInt(cacheTime)) < 300000) { // 5 minutes cache
                cachedStories = JSON.parse(cachedData);
                lastUpdateTime = parseInt(cacheTime);
                renderFeed(cachedStories);
                return;
            }
            
            // Load from Firebase or use demo data if no Firebase data
            loadStoriesFromFirebase();
        }

        async function loadStoriesFromFirebase() {
            try {
                const snapshot = await db.ref('stories').orderByChild('createdAt').limitToLast(20).once('value');
                if (snapshot.exists()) {
                    const stories = [];
                    snapshot.forEach(childSnapshot => {
                        const story = childSnapshot.val();
                        story.id = childSnapshot.key;
                        stories.unshift(story); // Newest first
                    });
                    
                    // Cache the stories
                    localStorage.setItem('radioStories', JSON.stringify(stories));
                    localStorage.setItem('radioStoriesTime', Date.now().toString());
                    
                    cachedStories = stories;
                    lastUpdateTime = Date.now();
                    
                    renderFeed(stories);
                } else {
                    // Use demo data if no Firebase stories
                    loadDemoStories();
                }
            } catch (error) {
                console.error("Error loading stories:", error);
                loadDemoStories();
            }
        }

        function loadDemoStories() {
            // Enhanced demo stories for radio/podcast
            feedCards = [
                {
                    id: 1,
                    title: "Midnight Thoughts",
                    description: "A late-night reflection on life, dreams, and the universe. Recorded during a quiet winter night. The stars were particularly bright that evening, and the silence was broken only by the occasional owl hoot. This story explores the depths of human consciousness and our connection to the cosmos.",
                    background: "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
                    tags: ["audio", "reflection", "philosophy"],
                    viewers: 1245,
                    type: "podcast",
                    icon: "🎙️",
                    likes: 42,
                    cardType: "podcast",
                    startTime: "45 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                    author: "Alex Johnson",
                    duration: "45:12"
                },
                {
                    id: 2,
                    title: "Urban Legends",
                    description: "True crime stories from the city that never sleeps. Episode 3: The Subway Mystery. A detective's journey through the underground tunnels reveals secrets that were meant to stay buried. Witness accounts, police reports, and chilling evidence come together in this gripping narrative.",
                    background: "linear-gradient(135deg, #f093fb 0%, #f5576c 100%)",
                    tags: ["trending", "true-crime", "mystery"],
                    viewers: 2892,
                    type: "audio",
                    icon: "🔍",
                    likes: 131,
                    cardType: "audio",
                    startTime: "32 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                    author: "True Crime Network",
                    duration: "32:45"
                },
                {
                    id: 3,
                    title: "Science Simplified",
                    description: "Quantum physics explained in simple terms. Today: The Double Slit Experiment. We break down one of the most baffling experiments in physics that challenges our understanding of reality itself. No PhD required to understand these mind-bending concepts.",
                    background: "linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)",
                    tags: ["science", "education", "trending"],
                    viewers: 1567,
                    type: "radio",
                    icon: "🔬",
                    likes: 78,
                    cardType: "radio",
                    startTime: "28 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3",
                    author: "Dr. Sarah Chen",
                    duration: "28:20"
                },
                {
                    id: 4,
                    title: "Poetry Hour",
                    description: "Classic and contemporary poetry readings with musical accompaniment. Featuring works from Maya Angelou, Robert Frost, and modern spoken word artists. Each poem is carefully selected and performed with emotional depth.",
                    background: "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)",
                    tags: ["poetry", "arts", "live"],
                    viewers: 2341,
                    type: "podcast",
                    icon: "📜",
                    likes: 156,
                    cardType: "podcast",
                    startTime: "60 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3",
                    author: "Literary Society",
                    duration: "60:00"
                },
                {
                    id: 5,
                    title: "History Uncovered",
                    description: "Forgotten stories from World War II. Episode: The Secret Resistance. Based on recently declassified documents, this episode reveals the untold story of ordinary citizens who risked everything to fight oppression.",
                    background: "linear-gradient(135deg, #fa709a 0%, #fee140 100%)",
                    tags: ["history", "documentary", "new"],
                    viewers: 1456,
                    type: "audio",
                    icon: "📜",
                    likes: 89,
                    cardType: "audio",
                    startTime: "52 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3",
                    author: "Historical Society",
                    duration: "52:30"
                },
                {
                    id: 6,
                    title: "Meditation Guide",
                    description: "Guided meditation for stress relief and mindfulness. Perfect for beginners. This session focuses on breathing techniques and visualization to help you find inner peace and reduce anxiety in just 25 minutes.",
                    background: "linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%)",
                    tags: ["meditation", "wellness", "health"],
                    viewers: 3890,
                    type: "radio",
                    icon: "🧘",
                    likes: 273,
                    cardType: "radio",
                    startTime: "25 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3",
                    author: "Mindful Moments",
                    duration: "25:15"
                },
                {
                    id: 7,
                    title: "Tech Talk Daily",
                    description: "Latest tech news and AI developments. Today: The Future of Quantum Computing. Interviews with leading researchers and analysis of how quantum computing will revolutionize everything from medicine to cryptography.",
                    background: "linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%)",
                    tags: ["tech", "ai", "trending"],
                    viewers: 3321,
                    type: "podcast",
                    icon: "💻",
                    likes: 124,
                    cardType: "podcast",
                    startTime: "38 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3",
                    author: "Tech Insider",
                    duration: "38:45"
                },
                {
                    id: 8,
                    title: "Jazz Classics",
                    description: "Smooth jazz recordings from the 1950s-60s. Featuring Miles Davis and John Coltrane. Rare recordings and commentary on the golden age of jazz. Perfect background music for working, studying, or relaxing.",
                    background: "linear-gradient(135deg, #30cfd0 0%, #330867 100%)",
                    tags: ["music", "jazz", "classic"],
                    viewers: 2789,
                    type: "audio",
                    icon: "🎷",
                    likes: 188,
                    cardType: "audio",
                    startTime: "75 min",
                    audioUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3",
                    author: "Jazz Archive",
                    duration: "75:20"
                }
            ];

            // Cache demo stories
            localStorage.setItem('radioStories', JSON.stringify(feedCards));
            localStorage.setItem('radioStoriesTime', Date.now().toString());
            
            cachedStories = feedCards;
            lastUpdateTime = Date.now();
            
            renderFeed(feedCards);
        }

        function renderFeed(stories) {
            const feedContainer = document.getElementById('verticalFeed');
            const scrollIndicator = document.getElementById('scrollIndicator');
            
            // Clear containers
            feedContainer.innerHTML = '';
            scrollIndicator.innerHTML = '';
            
            // Limit to 20 cards
            const cardsToShow = stories.slice(0, 20);
            
            // Create feed cards
            cardsToShow.forEach((card, index) => {
                const feedCard = document.createElement('div');
                feedCard.className = 'feed-card';
                feedCard.style.background = card.background;
                feedCard.dataset.index = index;
                feedCard.dataset.id = card.id;
                feedCard.dataset.type = card.cardType;
                
                // Add audio visualizer
                const audioVisualizer = document.createElement('div');
                audioVisualizer.className = 'audio-visualizer-container';
                audioVisualizer.innerHTML = `
                    <div class="audio-visualizer">
                        ${Array(15).fill().map((_, i) => `<div class="visualizer-bar"></div>`).join('')}
                    </div>
                `;
                feedCard.appendChild(audioVisualizer);
                
                // Add advanced audio player controls
                const audioPlayerOverlay = document.createElement('div');
                audioPlayerOverlay.className = 'audio-player-overlay';
                audioPlayerOverlay.innerHTML = `
                    <div class="player-header">
                        <div class="player-track-info">
                            <div class="player-track-title">${card.title}</div>
                            <div class="player-track-author">${card.author}</div>
                        </div>
                        <button class="player-close" onclick="stopAudio()">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="progress-container">
                        <input type="range" class="progress-bar" min="0" max="100" value="0" oninput="seekAudio(this.value)" onchange="seekAudio(this.value)">
                        <div class="progress-time">
                            <span class="current-time">0:00</span>
                            <span class="duration">${card.duration}</span>
                        </div>
                    </div>
                    
                    <div class="playback-controls">
                        <button class="control-btn skip" onclick="skipBackward()">
                            <i class="fas fa-step-backward"></i>
                        </button>
                        <button class="control-btn play-pause" onclick="toggleAudioPlayback()">
                            <i class="fas fa-play"></i>
                        </button>
                        <button class="control-btn skip" onclick="skipForward()">
                            <i class="fas fa-step-forward"></i>
                        </button>
                    </div>
                `;
                feedCard.appendChild(audioPlayerOverlay);
                
                const tagsHtml = card.tags.map(tag => {
                    let className = 'card-tag';
                    if (tag === 'live') className += ' live';
                    if (tag === 'trending') className += ' trending';
                    if (tag === 'podcast') className += ' podcast';
                    if (tag === 'audio') className += ' audio';
                    if (tag === 'new') className += ' new';
                    return `<span class="${className}">${tag.toUpperCase().replace('-', ' ')}</span>`;
                }).join('');
                
                const isLiked = likedStories.has(card.id);
                const likeBtnClass = isLiked ? 'action-btn liked' : 'action-btn';
                const likeIcon = isLiked ? 'fas fa-heart' : 'far fa-heart';
                const likeCount = card.likes;
                
                // Format viewers count with K/M
                const formattedViewers = formatNumber(card.viewers);
                
                const feedCardContent = document.createElement('div');
                feedCardContent.className = 'feed-card-content';
                feedCardContent.innerHTML = `
                    <div class="card-type-indicator ${card.cardType}">
                        <i class="fas ${card.cardType === 'podcast' ? 'fa-podcast' : card.cardType === 'audio' ? 'fa-headphones' : 'fa-broadcast-tower'}"></i>
                        ${card.cardType === 'podcast' ? 'Podcast' : card.cardType === 'audio' ? 'Audio Story' : 'Radio Show'}
                    </div>
                    
                    <div class="live-indicator">
                        <i class="fas fa-clock"></i>
                        <span class="live-text">${card.duration || card.startTime}</span>
                    </div>
                    
                    <div class="card-tags">
                        ${tagsHtml}
                    </div>
                    
                    <h2 class="card-title">${card.title}</h2>
                    <p class="card-description">${card.description}</p>
                    
                    <div class="card-stats">
                        <div class="viewers-count">
                            <i class="fas fa-headphones"></i>
                            ${formattedViewers} listeners
                        </div>
                        <div class="card-actions">
                            <button class="action-btn play-btn" onclick="playStory(${card.id}, this, event)">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="${likeBtnClass}" onclick="likeStory(${card.id}, this, event)">
                                <i class="${likeIcon}"></i>
                                <span class="like-count">${likeCount}</span>
                            </button>
                            <button class="action-btn" onclick="shareStory(${card.id}, event)">
                                <i class="fas fa-share"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                feedCard.appendChild(feedCardContent);
                feedContainer.appendChild(feedCard);
                
                // Add scroll indicator dot
                const dot = document.createElement('div');
                dot.className = 'scroll-dot';
                dot.dataset.index = index;
                if (index === 0) dot.classList.add('active');
                scrollIndicator.appendChild(dot);
            });
            
            // Update scroll indicator on scroll
            feedContainer.addEventListener('scroll', updateScrollIndicator);
            
            // Hide swipe hint after first scroll
            setTimeout(() => {
                document.getElementById('swipeHint').style.opacity = '0';
            }, 3000);
        }

        function updateScrollIndicator() {
            const feed = document.getElementById('verticalFeed');
            const scrollPos = feed.scrollTop;
            const cardHeight = window.innerHeight - 126;
            const currentIndex = Math.round(scrollPos / cardHeight);
            
            document.querySelectorAll('.scroll-dot').forEach((dot, index) => {
                dot.classList.toggle('active', index === currentIndex);
            });
            
            currentFeedIndex = currentIndex;
        }

        // ===== ADVANCED AUDIO PLAYER SYSTEM =====
        function playStory(storyId, button, event) {
            if (event) event.stopPropagation();
            
            const currentUser = auth.currentUser;
            if (!currentUser) {
                showToast("Please login to play stories", "error");
                return;
            }
            
            // Find the story
            const story = feedCards.find(card => card.id === storyId) || 
                         (cachedStories && cachedStories.find(card => card.id === storyId));
            
            if (!story) {
                showToast("Story not found", "error");
                return;
            }
            
            // Get the card element
            const cardElement = button.closest('.feed-card');
            
            // If clicking on same card that's already playing, just toggle playback
            if (currentPlayingCard === cardElement && currentAudio) {
                toggleAudioPlayback();
                return;
            }
            
            // Stop current audio if playing
            if (currentAudio) {
                currentAudio.pause();
                if (currentPlayingCard) {
                    currentPlayingCard.classList.remove('playing');
                    const playBtn = currentPlayingCard.querySelector('.play-btn');
                    if (playBtn) {
                        playBtn.innerHTML = '<i class="fas fa-play"></i>';
                        playBtn.classList.remove('playing');
                    }
                }
            }
            
            // Create or reuse audio element
            if (!currentAudio || currentAudio.src !== story.audioUrl) {
                currentAudio = new Audio(story.audioUrl);
                
                // Set up audio events
                currentAudio.addEventListener('play', function() {
                    cardElement.classList.add('playing');
                    const playBtn = cardElement.querySelector('.play-btn');
                    if (playBtn) {
                        playBtn.innerHTML = '<i class="fas fa-pause"></i>';
                        playBtn.classList.add('playing');
                    }
                    
                    // Update play button in player controls
                    const playerPlayBtn = cardElement.querySelector('.control-btn.play-pause');
                    if (playerPlayBtn) {
                        playerPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
                    }
                    
                    // Update play count in Firebase
                    updatePlayCount(storyId);
                    
                    // Start progress update interval
                    startProgressUpdate(cardElement);
                });
                
                currentAudio.addEventListener('pause', function() {
                    cardElement.classList.remove('playing');
                    const playBtn = cardElement.querySelector('.play-btn');
                    if (playBtn) {
                        playBtn.innerHTML = '<i class="fas fa-play"></i>';
                        playBtn.classList.remove('playing');
                    }
                    
                    // Update play button in player controls
                    const playerPlayBtn = cardElement.querySelector('.control-btn.play-pause');
                    if (playerPlayBtn) {
                        playerPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                    }
                    
                    // Clear progress interval
                    if (audioProgressInterval) {
                        clearInterval(audioProgressInterval);
                        audioProgressInterval = null;
                    }
                });
                
                currentAudio.addEventListener('ended', function() {
                    cardElement.classList.remove('playing');
                    const playBtn = cardElement.querySelector('.play-btn');
                    if (playBtn) {
                        playBtn.innerHTML = '<i class="fas fa-play"></i>';
                        playBtn.classList.remove('playing');
                    }
                    
                    // Update play button in player controls
                    const playerPlayBtn = cardElement.querySelector('.control-btn.play-pause');
                    if (playerPlayBtn) {
                        playerPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                    }
                    
                    // Reset progress
                    const progressBar = cardElement.querySelector('.progress-bar');
                    const currentTime = cardElement.querySelector('.current-time');
                    if (progressBar) progressBar.value = 0;
                    if (currentTime) currentTime.textContent = '0:00';
                    
                    // Clear progress interval
                    if (audioProgressInterval) {
                        clearInterval(audioProgressInterval);
                        audioProgressInterval = null;
                    }
                    
                    currentAudio = null;
                    currentPlayingCard = null;
                });
                
                // Handle metadata loaded
                currentAudio.addEventListener('loadedmetadata', function() {
                    const durationElement = cardElement.querySelector('.duration');
                    if (durationElement && !durationElement.dataset.initialized) {
                        const duration = formatTime(currentAudio.duration);
                        durationElement.textContent = duration;
                        durationElement.dataset.initialized = true;
                    }
                });
            }
            
            // Play the audio
            currentAudio.play().catch(error => {
                console.error("Audio playback error:", error);
                showToast("Could not play audio", "error");
            });
            
            currentPlayingCard = cardElement;
        }

        function toggleAudioPlayback() {
            if (!currentAudio) return;
            
            if (currentAudio.paused) {
                currentAudio.play();
            } else {
                currentAudio.pause();
            }
        }

        function skipBackward() {
            if (!currentAudio) return;
            
            currentAudio.currentTime = Math.max(0, currentAudio.currentTime - 10);
            updateProgressBar(currentPlayingCard);
            showToast("Rewinded 10 seconds", "info");
        }

        function skipForward() {
            if (!currentAudio) return;
            
            currentAudio.currentTime = Math.min(currentAudio.duration, currentAudio.currentTime + 10);
            updateProgressBar(currentPlayingCard);
            showToast("Skipped forward 10 seconds", "info");
        }

        function seekAudio(value) {
            if (!currentAudio) return;
            
            const seekTime = (value / 100) * currentAudio.duration;
            currentAudio.currentTime = seekTime;
            updateProgressBar(currentPlayingCard);
        }

        function startProgressUpdate(cardElement) {
            if (audioProgressInterval) {
                clearInterval(audioProgressInterval);
            }
            
            audioProgressInterval = setInterval(() => {
                updateProgressBar(cardElement);
            }, 100);
        }

        function updateProgressBar(cardElement) {
            if (!currentAudio || !cardElement) return;
            
            const progressBar = cardElement.querySelector('.progress-bar');
            const currentTimeElement = cardElement.querySelector('.current-time');
            
            if (progressBar && currentTimeElement) {
                const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
                progressBar.value = progress;
                currentTimeElement.textContent = formatTime(currentAudio.currentTime);
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds)) return "0:00";
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function stopAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                
                if (currentPlayingCard) {
                    currentPlayingCard.classList.remove('playing');
                    const playBtn = currentPlayingCard.querySelector('.play-btn');
                    if (playBtn) {
                        playBtn.innerHTML = '<i class="fas fa-play"></i>';
                        playBtn.classList.remove('playing');
                    }
                    
                    const playerPlayBtn = currentPlayingCard.querySelector('.control-btn.play-pause');
                    if (playerPlayBtn) {
                        playerPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                    }
                    
                    const progressBar = currentPlayingCard.querySelector('.progress-bar');
                    const currentTime = currentPlayingCard.querySelector('.current-time');
                    if (progressBar) progressBar.value = 0;
                    if (currentTime) currentTime.textContent = '0:00';
                }
                
                if (audioProgressInterval) {
                    clearInterval(audioProgressInterval);
                    audioProgressInterval = null;
                }
                
                currentAudio = null;
                currentPlayingCard = null;
            }
        }

        async function updatePlayCount(storyId) {
            try {
                const storyRef = db.ref('stories/' + storyId + '/plays');
                await storyRef.transaction(current => (current || 0) + 1);
                
                // Update cache if exists
                if (cachedStories) {
                    const storyIndex = cachedStories.findIndex(card => card.id === storyId);
                    if (storyIndex !== -1) {
                        cachedStories[storyIndex].plays = (cachedStories[storyIndex].plays || 0) + 1;
                        localStorage.setItem('radioStories', JSON.stringify(cachedStories));
                    }
                }
            } catch (error) {
                console.error("Error updating play count:", error);
            }
        }

        // ===== LIKE SYSTEM =====
        async function loadLikedStories(userId) {
            try {
                const snapshot = await db.ref('user_likes/' + userId).once('value');
                if (snapshot.exists()) {
                    const likes = snapshot.val();
                    Object.keys(likes).forEach(storyId => {
                        likedStories.add(storyId);
                    });
                }
            } catch (error) {
                console.error("Error loading liked stories:", error);
            }
        }

        async function likeStory(storyId, button, event) {
            if (event) event.stopPropagation();
            
            const currentUser = auth.currentUser;
            if (!currentUser) {
                showToast("Please login to like stories", "error");
                return;
            }

            const isLiked = likedStories.has(storyId);
            const userLikeRef = db.ref('user_likes/' + currentUser.uid + '/' + storyId);
            
            try {
                if (isLiked) {
                    // Unlike
                    likedStories.delete(storyId);
                    await userLikeRef.remove();
                    
                    if (button) {
                        button.classList.remove('liked');
                        button.innerHTML = '<i class="far fa-heart"></i><span class="like-count">' + (parseInt(button.querySelector('.like-count').textContent) - 1) + '</span>';
                    }
                    
                    // Update story likes count in Firebase
                    await updateStoryLikes(storyId, -1);
                    
                    showToast("Removed from saved", "info");
                } else {
                    // Like - show popup if needed
                    if (!dontShowLikePopup && likePopupCount < 3) {
                        showLikePopup();
                        likePopupCount++;
                        localStorage.setItem('likePopupCount', likePopupCount.toString());
                    }
                    
                    likedStories.add(storyId);
                    await userLikeRef.set(true);
                    
                    if (button) {
                        button.classList.add('liked');
                        const newCount = parseInt(button.querySelector('.like-count').textContent) + 1;
                        button.innerHTML = '<i class="fas fa-heart"></i><span class="like-count">' + newCount + '</span>';
                    }
                    
                    // Update story likes count in Firebase
                    await updateStoryLikes(storyId, 1);
                    
                    showToast("Story saved to favorites!", "success");
                }
                
                // Update cache if exists
                if (cachedStories) {
                    const storyIndex = cachedStories.findIndex(card => card.id === storyId);
                    if (storyIndex !== -1) {
                        cachedStories[storyIndex].likes = isLiked ? 
                            (cachedStories[storyIndex].likes - 1) : 
                            (cachedStories[storyIndex].likes + 1);
                        localStorage.setItem('radioStories', JSON.stringify(cachedStories));
                    }
                }
            } catch (error) {
                console.error("Error liking story:", error);
                showToast("Failed to save story: " + error.message, "error");
            }
        }

        async function updateStoryLikes(storyId, delta) {
            try {
                const storyRef = db.ref('stories/' + storyId + '/likes');
                await storyRef.transaction(current => {
                    const currentValue = current || 0;
                    return Math.max(0, currentValue + delta);
                });
            } catch (error) {
                console.error("Error updating story likes:", error);
            }
        }

        function showLikePopup() {
            const popup = document.getElementById('likePopup');
            popup.classList.add('active');
        }

        function closeLikePopup() {
            const popup = document.getElementById('likePopup');
            popup.classList.remove('active');
            
            // Check if user selected "Don't show again"
            const dontShowAgain = document.getElementById('dontShowAgain').checked;
            if (dontShowAgain) {
                dontShowLikePopup = true;
                localStorage.setItem('dontShowLikePopup', 'true');
            }
        }

        // Load user data from Firebase
        async function loadUserData(uid) {
            try {
                const snapshot = await db.ref('users/' + uid).once('value');
                const userData = snapshot.val();
                
                if (userData) {
                    document.getElementById('userName').value = userData.displayName || '';
                    document.getElementById('userEmail').value = userData.email || '';
                    
                    if (userData.photoURL) {
                        const avatarPreview = document.getElementById('avatarPreview');
                        avatarPreview.innerHTML = `<img src="${userData.photoURL}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
                    }
                }
            } catch (error) {
                console.error("Error loading user data:", error);
            }
        }

        // Update user profile in UI
        function updateUserProfile(user) {
            const profileBtn = document.getElementById('profileBtn');
            const profileInitials = document.getElementById('profileInitials');
            const avatarPreview = document.getElementById('avatarPreview');
            const avatarInitials = document.getElementById('avatarInitials');
            
            if (user) {
                let initials = 'U';
                if (user.displayName) {
                    initials = user.displayName.charAt(0).toUpperCase();
                } else if (user.email) {
                    initials = user.email.charAt(0).toUpperCase();
                }
                
                // Update profile button
                if (user.photoURL) {
                    profileBtn.innerHTML = `<img src="${user.photoURL}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
                } else {
                    profileInitials.textContent = initials;
                }
                
                // Update profile modal avatar
                if (avatarPreview) {
                    if (user.photoURL) {
                        avatarPreview.innerHTML = `<img src="${user.photoURL}" alt="Profile" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">`;
                    } else {
                        avatarInitials.textContent = initials;
                    }
                }
                
                // Update form fields
                document.getElementById('userName').value = user.displayName || '';
                document.getElementById('userEmail').value = user.email || '';
            }
        }

        // Delete profile picture
        async function deleteProfilePicture() {
            const currentUser = auth.currentUser;
            if (!currentUser) return;
            
            if (!confirm("Are you sure you want to remove your profile picture?")) return;
            
            try {
                showToast("Removing profile picture...", "info");
                
                // Update Firebase user profile
                await currentUser.updateProfile({
                    photoURL: null
                });
                
                // Update in database
                await db.ref('users/' + currentUser.uid).update({
                    photoURL: null,
                    updatedAt: Date.now()
                });
                
                // Update UI
                updateUserProfile(currentUser);
                showToast("Profile picture removed", "success");
                
            } catch (error) {
                console.error("Error deleting profile picture:", error);
                showToast("Failed to remove profile picture", "error");
            }
        }

        // Story submission functions
        function openStoryModal() {
            const modal = document.getElementById('storyModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeStoryModal() {
            const modal = document.getElementById('storyModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function submitViaEmail() {
            const title = document.getElementById('storyTitle').value || 'My Story Submission';
            const content = document.getElementById('storyContent').value || '';
            
            const emailBody = `Title: ${title}%0D%0A%0D%0AStory:%0D%0A${encodeURIComponent(content)}%0D%0A%0D%0ASubmitted via RADIO Podcast App`;
            const mailtoLink = `mailto:submitmystory@gmail.com?subject=Story Submission: ${encodeURIComponent(title)}&body=${emailBody}`;
            
            window.location.href = mailtoLink;
        }

        function formatText(command) {
            const textarea = document.getElementById('storyContent');
            textarea.focus();
            
            // For basic text formatting (in a real app, you'd use a proper rich text editor)
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            let formattedText = '';
            switch(command) {
                case 'bold':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'italic':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'underline':
                    formattedText = `__${selectedText}__`;
                    break;
            }
            
            textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
            
            // Restore cursor position
            textarea.selectionStart = start + formattedText.length;
            textarea.selectionEnd = start + formattedText.length;
        }

        // Open profile modal
        function openProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close profile modal
        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Show coming soon (for notifications)
        function showComingSoon(feature) {
            showToast(`${feature} feature coming soon!`, "info");
        }

        // Story interactions
        function shareStory(storyId, event) {
            if (event) event.stopPropagation();
            
            const story = feedCards.find(card => card.id === storyId) || 
                         (cachedStories && cachedStories.find(card => card.id === storyId));
            
            if (story) {
                if (navigator.share) {
                    navigator.share({
                        title: story.title,
                        text: story.description,
                        url: window.location.href
                    });
                } else {
                    showToast(`Shared "${story.title}"`, "info");
                }
            }
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast';
            
            if (type === 'success') {
                toast.style.background = 'linear-gradient(135deg, var(--success), #00b894)';
            } else if (type === 'error') {
                toast.style.background = 'linear-gradient(135deg, var(--red-accent), #ff6b6b)';
            } else if (type === 'warning') {
                toast.style.background = 'linear-gradient(135deg, var(--warning), #ffaa00)';
            } else {
                toast.style.background = 'linear-gradient(135deg, var(--primary-purple), var(--neon-magenta))';
            }
            
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Simulate live updates
        function simulateLiveUpdates() {
            setInterval(() => {
                // Update listener counts randomly
                document.querySelectorAll('.viewers-count').forEach(el => {
                    const text = el.textContent;
                    const match = text.match(/([\d.]+)([KM]?)/);
                    if (match) {
                        let current = parseFloat(match[1]);
                        const suffix = match[2];
                        
                        // Convert back to number
                        if (suffix === 'K') current *= 1000;
                        if (suffix === 'M') current *= 1000000;
                        
                        const change = Math.floor(Math.random() * 21) - 10;
                        const newCount = Math.max(100, current + change);
                        el.innerHTML = `<i class="fas fa-headphones"></i> ${formatNumber(newCount)} listeners`;
                    }
                });
                
                // Check for new stories every 30 seconds
                if (lastUpdateTime && (Date.now() - lastUpdateTime) > 30000) {
                    loadFeed();
                }
            }, 8000);
        }

        // Sign out function
        async function signOut() {
            try {
                // Stop audio if playing
                if (currentAudio) {
                    currentAudio.pause();
                    currentAudio = null;
                }
                
                // Clear progress interval
                if (audioProgressInterval) {
                    clearInterval(audioProgressInterval);
                    audioProgressInterval = null;
                }
                
                await auth.signOut();
                showToast("Signed out successfully", "success");
                setTimeout(() => {
                    window.location.href = "index.html";
                }, 1000);
            } catch (error) {
                console.error("Sign out error:", error);
                showToast("Sign out failed: " + error.message, "error");
            }
        }

        // Add click animation to cards
        document.addEventListener('click', function(e) {
            if (e.target.closest('.action-btn')) {
                const btn = e.target.closest('.action-btn');
                btn.style.transform = 'scale(0.9)';
                setTimeout(() => {
                    btn.style.transform = '';
                }, 200);
            }
        });
    </script>
</body>
</html>
